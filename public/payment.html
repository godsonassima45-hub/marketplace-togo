<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement - MarketPlace TG</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><i class="fas fa-store"></i> MarketPlace TG</h1>
                </div>
                <nav class="nav">
                    <ul>
                        <li><a href="index.html">Accueil</a></li>
                        <li><a href="#products">Produits</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-menu" id="userMenu">
                        <span id="userName">Client</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Payment Section -->
    <section class="payment-section">
        <div class="container">
            <div class="payment-container">
                <div class="payment-header">
                    <h2>Finaliser votre commande</h2>
                    <p>Choisissez votre méthode de paiement Mobile Money</p>
                </div>

                <!-- Order Summary -->
                <div class="order-summary">
                    <h3>Récapitulatif de la commande</h3>
                    <div id="orderDetails">
                        <!-- Order details will be loaded here -->
                    </div>
                    <div class="summary-totals">
                        <div class="total-row">
                            <span>Sous-total:</span>
                            <span id="subtotal">0 FCFA</span>
                        </div>
                        <div class="total-row">
                            <span>Livraison:</span>
                            <span id="shipping">0 FCFA</span>
                        </div>
                        <div class="total-row commission">
                            <span>Commission plateforme (10%):</span>
                            <span id="commission">0 FCFA</span>
                        </div>
                        <div class="total-row final-total">
                            <span>Total:</span>
                            <span id="totalAmount">0 FCFA</span>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="payment-methods">
                    <h3>Méthodes de paiement</h3>
                    <div class="payment-options">
                        <button class="payment-option" data-method="flooz">
                            <div class="payment-logo">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="payment-info">
                                <h4>Flooz</h4>
                                <p>Paiement par Flooz</p>
                            </div>
                        </button>
                        
                        <button class="payment-option" data-method="tmoney">
                            <div class="payment-logo">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="payment-info">
                                <h4>TMoney</h4>
                                <p>Paiement par TMoney</p>
                            </div>
                        </button>
                        
                        <button class="payment-option" data-method="orange-money">
                            <div class="payment-logo">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="payment-info">
                                <h4>Orange Money</h4>
                                <p>Paiement par Orange Money</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Payment Form -->
                <div class="payment-form" id="paymentForm" style="display: none;">
                    <h3>Informations de paiement</h3>
                    <form id="mobileMoneyForm">
                        <div class="form-group">
                            <label for="phoneNumber">Numéro de téléphone Mobile Money</label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" 
                                   placeholder="+228 90 00 00 00" required
                                   pattern="[+][0-9]{2,3}[0-9]{8,12}">
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPhone">Confirmer le numéro</label>
                            <input type="tel" id="confirmPhone" name="confirmPhone" 
                                   placeholder="+228 90 00 00 00" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="otpCode">Code OTP (reçu par SMS)</label>
                            <input type="text" id="otpCode" name="otpCode" 
                                   placeholder="Entrez le code à 6 chiffres" 
                                   maxlength="6" pattern="[0-9]{6}">
                        </div>
                        
                        <div class="payment-actions">
                            <button type="button" class="btn btn-outline" id="cancelPayment">
                                Annuler
                            </button>
                            <button type="button" class="btn btn-primary" id="requestOtpBtn">
                                <i class="fas fa-sms"></i> Recevoir le code OTP
                            </button>
                            <button type="submit" class="btn btn-primary" id="confirmPaymentBtn" style="display: none;">
                                <i class="fas fa-lock"></i> Confirmer le paiement
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Shipping Information -->
                <div class="shipping-info">
                    <h3>Informations de livraison</h3>
                    <form id="shippingForm">
                        <div class="form-group">
                            <label for="fullName">Nom complet</label>
                            <input type="text" id="fullName" name="fullName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Adresse de livraison</label>
                            <textarea id="address" name="address" required rows="3"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">Ville</label>
                                <select id="city" name="city" required>
                                    <option value="">Sélectionner une ville</option>
                                    <option value="lome">Lomé</option>
                                    <option value="kara">Kara</option>
                                    <option value="sokode">Sokodé</option>
                                    <option value="palimero">Paliméro</option>
                                    <option value="atsapame">Atsapamé</option>
                                    <option value="aného">Aného</option>
                                    <option value="bassar">Bassar</option>
                                    <option value="tsévié">Tsévié</option>
                                    <option value="mango">Mango</option>
                                    <option value="bafilo">Bafilo</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="postalCode">Code postal</label>
                                <input type="text" id="postalCode" name="postalCode" placeholder="BP 1234">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="deliveryNotes">Instructions de livraison (optionnel)</label>
                            <textarea id="deliveryNotes" name="deliveryNotes" rows="2" 
                                      placeholder="Ex: Livrer après 17h, appeler avant de livrer..."></textarea>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Payment Processing Modal -->
    <div class="modal" id="processingModal">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="processing-animation">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <h3>Traitement du paiement...</h3>
                <p>Veuillez patienter pendant que nous traitons votre paiement</p>
            </div>
        </div>
    </div>

    <!-- Payment Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Paiement réussi!</h3>
                <p>Votre commande a été confirmée avec succès</p>
                <div class="success-details">
                    <p><strong>Numéro de commande:</strong> <span id="orderNumber"></span></p>
                    <p><strong>Montant payé:</strong> <span id="paidAmount"></span></p>
                </div>
                <div class="success-actions">
                    <button class="btn btn-outline" onclick="window.location.href='index.html'">
                        Retour à l'accueil
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='index.html'">
                        Voir mes commandes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="error-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <h3>Échec du paiement</h3>
                <p id="errorMessage">Une erreur est survenue lors du traitement de votre paiement</p>
                <div class="error-actions">
                    <button class="btn btn-outline" onclick="paymentManager.closeErrorModal()">
                        Réessayer
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='index.html'">
                        Retour à l'accueil
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <i class="fas fa-check-circle"></i>
            <span id="notificationMessage"></span>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/payment.js"></script>
</body>
</html>
